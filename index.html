<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>CRUD with MockAPI</title>
    <link rel="stylesheet" href="style.css" />
</head>
<body>
    <h1>SHOPPING CENTRE</h1>

    <!-- Form for adding/updating products -->
    <form id="productForm">
        <input type="hidden" id="productId" />
        <input type="text" id="productName" placeholder="Product Name" required />
        <input type="number" id="productPrice" placeholder="Product Price" required />
        <button type="submit">Save Product</button>
        <!-- Read Product button positioned under Save Product button -->
        <button type="button" id="readButton">Read Products</button>
    </form>

    <!-- Table to display products -->
    <table id="productTable">
        <thead>
            <tr>
                <th>ID</th>
                <th>Name</th>
                <th>Price</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody></tbody>
    </table>
<script>
    const apiURL = "https://672d9a09fd8979715642efeb.mockapi.io/product/v1/lays";
const productForm = document.getElementById("productForm");
const productIdInput = document.getElementById("productId");
const productNameInput = document.getElementById("productName");
const productPriceInput = document.getElementById("productPrice");
const productTable = document.getElementById("productTable");
const productTableBody = productTable.querySelector("tbody");
const readButton = document.getElementById("readButton");

// Fetch and display all products
async function fetchProducts() {
    try {
        const response = await fetch(apiURL);
        const products = await response.json();
        displayProducts(products);
        productTable.style.display = "table"; // Show table
    } catch (error) {
        console.error("Error fetching products:", error);
    }
}

// Display products in the table
function displayProducts(products) {
    productTableBody.innerHTML = "";
    products.forEach((product) => {
        const row = document.createElement("tr");
        row.innerHTML = `
            <td>${product.id}</td>
            <td>${product.name}</td>
            <td>$${product.price}</td>
            <td>
                <button class="btn-edit" onclick="editProduct('${product.id}', '${product.name}', ${product.price})">Edit</button>
                <button class="btn-delete" onclick="deleteProduct('${product.id}')">Delete</button>
            </td>
        `;
        productTableBody.appendChild(row);
    });
}

// Event listener for "Read" button
readButton.addEventListener("click", fetchProducts);

// Handle form submission for adding or updating
productForm.addEventListener("submit", async (event) => {
        event.preventDefault();
        const id = productIdInput.value;
        const name = productNameInput.value;
        const price = parseFloat(productPriceInput.value);

        const productData = { name, price };

        if (id) {
          
          await updateProduct(id, productData);
        } else {
          
          await addProduct(productData);
        }

        productForm.reset();
        fetchProducts(); 
      });

      
      async function addProduct(productData) {
        try {
          const response = await fetch(apiURL, {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
            },
            body: JSON.stringify(productData),
          });
          if (!response.ok) throw new Error("Failed to add product");
        } catch (error) {
          console.error("Error adding product:", error);
        }
      }

// Edit product - fill form with product details
function editProduct(id, name, price) {
    productIdInput.value = id;
    productNameInput.value = name;
    productPriceInput.value = price;
}

// Update existing product
async function updateProduct(id, productData) {
    try {
        const response = await fetch(`${apiURL}/${id}`, {
            method: "PUT",
            headers: {
                "Content-Type": "application/json",
            },
            body: JSON.stringify(productData),
        });
        if (!response.ok) throw new Error("Failed to update product");
    } catch (error) {
        console.error("Error updating product:", error);
    }
}

// Delete product
async function deleteProduct(id) {
    try {
        const response = await fetch(`${apiURL}/${id}`, {
            method: "DELETE",
        });
        if (!response.ok) throw new Error("Failed to delete product");
        fetchProducts();
    } catch (error) {
        console.error("Error deleting product:", error);
    }
}
</script>
</body>
</html>
